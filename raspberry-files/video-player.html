<script>
    const videoPlayer = document.getElementById('videoPlayer');
    let currentVideoIndex = 0;
    let videos = [];
    
    // Function to load video list
    async function loadVideos() {
        try {
            const response = await fetch('/raspberry-files/list-videos.php');
            videos = await response.json();
            console.log('Videos loaded:', videos);
            playNextVideo();
        } catch (error) {
            console.error('Error loading videos:', error);
            setTimeout(loadVideos, 5000);
        }
    }

    // Function to play next video
    function playNextVideo() {
        if (videos.length === 0) {
            setTimeout(loadVideos, 5000);
            return;
        }

        const videoFile = videos[currentVideoIndex];
        const videoUrl = `/kiosk/videos/${videoFile}`;
        console.log('Playing video:', videoUrl);

        videoPlayer.src = videoUrl;
        videoPlayer.play().catch(error => {
            console.error('Error playing video:', error);
            setTimeout(() => playNextVideo(), 1000);
        });

        currentVideoIndex = (currentVideoIndex + 1) % videos.length;
    }

    // Video optimization settings
    videoPlayer.addEventListener('loadedmetadata', () => {
        videoPlayer.playbackRate = 1.0;
    });

    videoPlayer.addEventListener('ended', playNextVideo);
    videoPlayer.addEventListener('error', () => {
        console.error('Video error:', videoPlayer.error);
        setTimeout(() => playNextVideo(), 1000);
    });

    // Start playing
    loadVideos();

    // Reload page every 6 hours to prevent any memory issues
    setTimeout(() => window.location.reload(), 21600000);
</script>